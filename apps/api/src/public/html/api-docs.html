<!doctype html>
<html>
  <head>
    <title>Versum API</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --scalar-font: "Libre Baskerville", serif;
        --scalar-font-code: "Courier New", monospace;
      }

      .light-mode {
        --scalar-color-1: #2b2b26;
        --scalar-color-2: #5f5a4f;
        --scalar-color-accent: #8b3f2f;
        --scalar-background-1: #f8f3ea;
        --scalar-background-2: #efe6d6;
        --scalar-background-3: #e3d7c3;
        --scalar-border-color: rgba(139, 63, 47, 0.18);
      }

      .dark-mode {
        --scalar-color-1: #f3eadb;
        --scalar-color-2: #d6c7a1;
        --scalar-color-accent: #b86b2f;
        --scalar-background-1: #1c170f;
        --scalar-background-2: #241e14;
        --scalar-background-3: #2e2619;
        --scalar-border-color: rgba(184, 107, 47, 0.25);
      }

      h1,
      h2,
      h3 {
        font-family: "Cinzel", serif;
        font-weight: 700;
        color: var(--scalar-color-accent) !important;
        letter-spacing: 0.5px;
      }

      /* Loading styles */
      /* Loading styles (theme-aware) */
      #loader {
        position: fixed;
        inset: 0;
        background: var(--scalar-background-1);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        transition: background 0.3s ease;
      }

      .container {
        position: relative;
        overflow: hidden;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .text {
        font-family: "Cinzel", serif;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--scalar-color-accent);
        white-space: nowrap;
        transition: color 0.3s ease;
      }

      #text-2 {
        position: absolute;
        opacity: 0;
      }
    </style>
  </head>

  <body>
    <div id="loader">
      <div class="container">
        <p id="text-1" class="text">Versum API</p>
        <p id="text-2" class="text">Loading...</p>
      </div>
    </div>

    <div id="app" style="display: none"></div>

    <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.14.1/dist/SplitText.min.js"></script>

    <script>
      gsap.registerPlugin(SplitText);

      const TEXT_1 = 0;
      const TEXT_2 = 1;
      let showingText = TEXT_1;

      const MIN_LOADING_TIME = 2000;
      const startTime = Date.now();

      const text1 = document.querySelector("#text-1");
      const text2 = document.querySelector("#text-2");

      const split1 = new SplitText(text1, { type: "chars" });
      const split2 = new SplitText(text2, { type: "chars" });

      gsap.set(text2, { opacity: 1 });
      gsap.set(split1.chars, { y: 40 });
      gsap.set(split2.chars, { y: 40 });

      // animação inicial
      gsap.to(split1.chars, {
        y: 0,
        stagger: 0.05,
        ease: "power4.out",
        duration: 0.8,
      });

      function animateText() {
        const current = showingText === TEXT_1 ? split1.chars : split2.chars;
        const next = showingText === TEXT_1 ? split2.chars : split1.chars;

        gsap.to(current, {
          y: -40,
          stagger: 0.05,
          ease: "power4.in",
          duration: 0.6,
        });

        gsap.fromTo(
          next,
          { y: 40 },
          {
            y: 0,
            stagger: 0.05,
            ease: "power4.out",
            duration: 0.8,
            delay: 0.35,
          },
        );

        showingText = showingText === TEXT_1 ? TEXT_2 : TEXT_1;
      }

      const interval = setInterval(animateText, 4000);

      // ======= SCALAR LOAD =======
      fetch("&{api_spec_url}")
        .then((res) => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then((spec) => {
          const elapsed = Date.now() - startTime;
          const remaining = Math.max(0, MIN_LOADING_TIME - elapsed);

          setTimeout(() => {
            gsap.to("#loader", {
              opacity: 0,
              duration: 0.6,
              ease: "power2.out",
              onComplete: () => {
                clearInterval(interval);
                document.getElementById("loader").remove();
                document.getElementById("app").style.display = "block";

                Scalar.createApiReference("#app", {
                  spec: { content: spec },
                  proxy: "&{proxy_url}",
                  theme: "none",
                  agent: {
                    key: "eyJhbGciOiJFZERTQSJ9.eyJ1aWQiOiJrUkNnelU1aEdKaUpwVWwwSUZTYlkiLCJ0ZWFtVWlkIjoicE1sbjcyY3JRdDVINGtxbEZENUxBIiwidXNlckluZGV4IjoiZWR1YXJkb2F1Z3VzdG9saW1hYnVlbm9Ab3V0bG9vay5jb20uYnIiLCJpYXQiOjE3NzEwMjkzNzgsImV4cCI6MTgwMjU2NTM3OH0.lZ3f_ww3orgTBq1pSp-pGxF1MI5ymCBiqIT3cbelpItBczzt7XS-PfmFiYuanGkZBQ6Cfh-7BkAxUbKfgcLUDg",
                  },
                  showSidebar: true,
                  withDefaultFonts: false,
                });
              },
            });
          }, remaining);
        })
        .catch((err) => {
          clearInterval(interval);
          document.getElementById("loader").innerHTML = `
        <pre style="color:red;padding:20px;">
Erro ao carregar API spec:
${err.message}
        </pre>
      `;
          console.error("Erro ao carregar spec:", err);
        });
    </script>
  </body>
</html>
